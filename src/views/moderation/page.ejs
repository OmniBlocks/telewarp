<h1>With great power comes great responsibility</h1>
<p>If you are not a moderator, please file a vulnerability on GitHub and explain how you got here.</p>

<table border="1" cellpadding="8" cellspacing="0">
  <thead>
    <tr>
      <th>Project ID</th>
      <th>Name</th>
      <th>Platform</th>
      <th>Created At</th>
      <th>Flagged</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% for (const project of projects) { %>
      <tr data-id="<%= project.id %>">
        <td><%= project.id %></td>
        <td><%= project.name %></td>
        <td><%= project.lang_id %></td>
        <td><%= new Date(project.created_at).toLocaleString() %></td>
        <td><%= project.flagged ? "Yes" : "No" %></td>
        <td>
          <button class="flag-btn">Flag</button>
          <button class="delete-btn">Delete</button>
        </td>
      </tr>
    <% } %>
  </tbody>
</table>

<script>
document.addEventListener("DOMContentLoaded", () => {
  async function sendAction(projectId, action) {
    const res = await fetch("/api/moderation", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ projectId, action })
    });
    const data = await res.json();
    if (data.success) location.reload();
    else alert(data.error || "Failed");
  }

  document.querySelectorAll(".flag-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.closest("tr").dataset.id;
      sendAction(id, "flag");
    });
  });

  document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.closest("tr").dataset.id;
      if (confirm("Are you sure you want to delete this project?")) {
        sendAction(id, "delete");
      }
    });
  });
});
</script>
