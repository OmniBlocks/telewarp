<% if (!error) { %>
  <% 
    const d = new Date(userData.joined);
    const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    const humanDate = `${months[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
  %>

  <div class="user-page">
    <div class="profile-header">
      <div class="user-info">
        <img src="<%= userData.avatarUrl %>" alt="<%= userData.username %>" class="profile-avatar">
        <div class="user-details">
          <h1><%= userData.username %></h1>
          <p class="user-meta">Joined <%= humanDate %></p>
        </div>
      </div>
      
      <% if (user && user.username === userData.username) { %>
        <div class="user-actions">
          <a href="/settings" class="btn btn-secondary">Settings</a>
        </div>
      <% } %>
    </div>

    <div class="info-row">
      <div class="box">
        <div class="box-header"><h3>About me</h3></div>
        <div class="inner-content"><%= userData.bio || "" %></div>
      </div>
      <div class="box">
        <div class="box-header"><h3>Featured Project</h3></div>
        <div class="inner-content">
          <% if (userData.featuredProjectId) { %>
            <a href="/project/<%= userData.featuredProjectId %>" class="featured-link">
              Featured Project #<%= userData.featuredProjectId %>
            </a>
          <% } %>
        </div>
      </div>
    </div>

    <div class="content-row">
      <div class="row-header">
        <h3>Shared Projects (<%= userProjects.length %>)</h3>
      </div>
      <div class="project-grid">
        <% if (userProjects && userProjects.length > 0) { %>
          <% userProjects.forEach(project => { %>
            <a href="/project/<%= project.id %>" class="project-card">
              <div class="card-thumb">
                <% if (project.thumbnail) { %>
                  <img src="/telewarp-projects/thumb_<%= project.id %>.png" onerror="this.src='/images/default-thumb.png'">
                <% } %>
              </div>
              <div class="card-info">
                <span class="project-name"><%= project.name %></span>
              </div>
            </a>
          <% }) %>
        <% } else { %>
          <div class="empty-msg"><%= userData.username %> hasn't shared any projects</div>
        <% } %>
      </div>
    </div>
  </div>
<% } %>